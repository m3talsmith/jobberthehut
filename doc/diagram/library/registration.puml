@startuml registration

actor Caller
entity Library
entity OS

autonumber

title Username Process: new username

Caller -> Library: Register(username: <username>)
Library -> Library: HashUsername(<username>)
Library -> OS: CheckUsernameExists(<hash>)
OS -> Library: false
Library -> OS: Make <hash> Directory in pools Directory
OS -> Library: <hash> Directory Created
Library -> Library: GenerateClientCertificate()
Library -> Library: Encrypt <certificate>
Library -> OS: Write <encrypted certificate> to <hash> Directory
Library -> Caller: <certificate>

newpage Username Process: existing username

autonumber 1

Caller -> Library: Register(username: <username>)
Library -> Library: HashUsername(<username>)
Library -> OS: CheckUsernameExists(<hash>)
OS -> Library: true
Library -> Caller: "Registration failed for <username>"

@enduml